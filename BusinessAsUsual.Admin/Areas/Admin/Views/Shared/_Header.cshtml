<header class="header-branding">
    <div class="brand-left">
        <img src="~/images/logo.png" alt="Business As Usual Logo" class="brand-logo" />
        <span class="brand-title">Business As Usual</span>
    </div>
    <div class="brand-right">
        <span class="brand-signature">Powered by LinearDescent</span>
    </div>
</header>

<nav class="navbar" role="navigation" aria-label="Main navigation">
    <ul id="nav-links" class="nav-links" role="complementary" aria-label="Sidebar menu"></ul>

    <div class="theme-switcher">
        <label for="theme-toggle">Theme:</label>
        <select id="theme-toggle">
            <option value="default">Default</option>
            <option value="dark">Dark Mode</option>
            <option value="light">Light</option>
            <option value="retro">LinearDescent Retro</option>
            <option value="contributor">Contributor Mode</option>
        </select>
    </div>
</nav>

<script>
    window.sidebarWasManuallyCollapsed = false;
    window.sidebarWasTriggeredByNavbar = false;
</script>

<script>
    async function initNavbar() {
      await loadMenuJson(); // Ensure menuData is ready

      const nav = document.getElementById("nav-links");
      if (!nav) return;

      nav.innerHTML = "";

      const currentPath = window.location.pathname;

      Object.keys(window.menuData).forEach(category => {
        const icon = window.menuData[category].icon || "fas fa-folder";
        const route = window.menuData[category].route || "#";
        const isActive = currentPath === route;

        nav.innerHTML += `
          <li class="${isActive ? 'active' : ''}">
            <a href="${route}" onclick="window.sidebarWasTriggeredByNavbar = true; window.renderSidebar('${category}'); return false;" aria-label="${category}">
              <i class="${icon}" aria-hidden="true"></i> ${category}
            </a>
          </li>`;
      });
    }

    window.addEventListener("DOMContentLoaded", initNavbar);
</script>

<script>
    window.renderSidebar = function(category) {
      const sidebar = document.getElementById("sidebar");
      const sidebarTitle = document.getElementById("sidebar-title");
      const sidebarLinks = document.getElementById("sidebar-links");

      const isHome = category === "Home" || category === "/";

      if (isHome) {
        sidebar.classList.add("collapsed");
        sidebar.classList.remove("expanded");
        sidebarTitle.textContent = "";
        sidebarLinks.innerHTML = "";
        window.sidebarWasManuallyCollapsed = false;
        window.sidebarWasTriggeredByNavbar = false;
        return;
      }

      if (window.sidebarWasTriggeredByNavbar && !window.sidebarWasManuallyCollapsed) {
        sidebar.classList.remove("collapsed");
        sidebar.classList.add("expanded");
      }

      sidebarTitle.textContent = category;
      sidebarLinks.innerHTML = "";

      const items = window.menuData?.[category]?.items || [];
      items.forEach(item => {
        sidebarLinks.innerHTML += `
          <li class="list-group-item">
            <a href="${item.route}" title="${item.description}" aria-label="${item.description}" onclick="window.sidebarWasTriggeredByNavbar = false;">
              <i class="${item.icon}" aria-hidden="true"></i>
              <span>${item.label}</span>
            </a>
          </li>`;
      });
    };
</script>