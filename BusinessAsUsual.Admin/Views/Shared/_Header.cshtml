<header class="header-branding">
    <div class="brand-left">
        <img src="~/images/logo.png" alt="Business As Usual Logo" class="brand-logo" />
        <span class="brand-title">Business As Usual</span>
    </div>
    <div class="brand-right">
        <span class="brand-signature">
            Powered by LinearDescent
            <a href="/Help" class="help-button" title="View Help">
                <i class="fas fa-question-circle"></i>
            </a>
        </span>
    </div>
</header>

<nav class="navbar" role="navigation" aria-label="Main navigation">
    <ul id="nav-links" class="nav-links" role="complementary" aria-label="Sidebar menu"></ul>

    <div class="theme-switcher">
        <label for="theme-toggle">Theme:</label>
        <select id="theme-toggle">
            <option value="default">Default</option>
            <option value="dark">Dark Mode</option>
            <option value="light">Light</option>
            <option value="retro">LinearDescent Retro</option>
            <option value="contributor">Contributor Mode</option>
        </select>
    </div>
</nav>

<script>
    globalThis.addEventListener("DOMContentLoaded", () => {
      const savedTheme = localStorage.getItem("selectedTheme") || "default";
      document.body.className = `theme-${savedTheme}`;

      const themeToggle = document.getElementById("theme-toggle");
      if (themeToggle) themeToggle.value = savedTheme;

      console.log(`[SmartCommit] Restored theme: ${savedTheme}`);
    });
</script>

<script>
    globalThis.addEventListener("DOMContentLoaded", () => {
      globalThis.renderNavbar();
    });
</script>

<script>
    globalThis.sidebarWasManuallyCollapsed = false;
    globalThis.sidebarWasTriggeredByNavbar = false;
</script>

<script>
    async function initNavbar() {
      await loadMenuJson(); // Ensure menuData is ready

      const nav = document.getElementById("nav-links");
      if (!nav) return;

      nav.innerHTML = "";
      const currentPath = globalThis.location.pathname;

      Object.entries(globalThis.menuData).forEach(([category, config]) => {
        const icon = config.icon || "fas fa-folder";
        const route = config.route || "#";
        const id = config.id || `nav-${category.toLowerCase()}`;
        const isActive = currentPath === route;

        const li = document.createElement("li");
        li.className = isActive ? "active" : "";

        const link = document.createElement("a");
        link.href = route;
        link.id = id;
        link.className = "nav-item";
        link.setAttribute("aria-label", category);
        link.innerHTML = `<i class="${icon}" aria-hidden="true"></i> ${category}`;

        link.addEventListener("click", function (e) {
          if (globalThis.location.pathname === route) {
            e.preventDefault();
            console.log(`[SmartCommit] Already on ${id}`);
            globalThis.renderSidebar(category);
          } else {
            console.log(`[SmartCommit] Redirecting to ${route} via ${id}`);
            globalThis.sidebarWasTriggeredByNavbar = true;
            globalThis.renderSidebar(category);
            globalThis.location.href = route;
          }
        });

        li.appendChild(link);
        nav.appendChild(li);
      });
    }

    globalThis.addEventListener("DOMContentLoaded", initNavbar);
</script>
