@page
@model BusinessAsUsual.Admin.Pages.Admin.ProvisionCompanyModel

<div class="container mt-4">
    <h2 class="fw-bold text-primary">Provision a New Company</h2>
    <form method="post">
        <div class="mb-3">
            <label asp-for="Company.Name" class="form-label"></label>
            <input asp-for="Company.Name" class="form-control" placeholder="e.g. NEXTRiff Inc." />
            <span asp-validation-for="Company.Name" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Company.DbName" class="form-label"></label>
            <input asp-for="Company.DbName" class="form-control" placeholder="e.g. NEXTRiffDB" />
        </div>

        <div class="mb-3">
            <label asp-for="Company.AdminEmail"></label>
            <input asp-for="Company.AdminEmail" class="form-control" placeholder="e.g. admin@nextriff.com" />
            <span asp-validation-for="Company.AdminEmail" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Company.BillingPlan"></label>
            <input asp-for="Company.BillingPlan" class="form-control" placeholder="e.g. admin@nextriff.com" />
            <span asp-validation-for="Company.BillingPlan" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Company.ModulesEnabled"></label>
            <input asp-for="Company.ModulesEnabled" class="form-control" placeholder="e.g. admin@nextriff.com" />
            <span asp-validation-for="Company.ModulesEnabled" class="text-danger"></span>
        </div>

        <button type="submit" class="btn btn-success fw-bold">
            Provision Company
        </button>
    </form>
</div>

<dialog id="statusModal">
    <p id="statusMessage">Working on it...</p>
    <div id="statusLog"></div>
    <button onclick="document.getElementById('statusModal').close()">Close</button>
</dialog>

@section Scripts {
    <script>
        document.querySelector("form").addEventListener("submit", function () {
            const modal = document.getElementById("statusModal");
            const message = document.getElementById("statusMessage");
            message.textContent = "Provisioning in progress";
            modal.showModal();
        }
    </script>
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.0/signalr.min.js"></script>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/provisioningHub")
            .build();

        connection.on("ReceiveStatus", function (message) {
            const modal = document.getElementById("statusModal");
            const log = document.getElementById("statusLog");
            log.innerHTML += `<p>${message}</p>`;
            modal.showModal();
        });

        connection.start();
    </script>
}